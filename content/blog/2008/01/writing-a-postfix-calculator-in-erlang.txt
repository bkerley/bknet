--- 
slug: writing-a-postfix-calculator-in-erlang
updated_at: 2008-03-02 18:12:37 -05:00
title: Writing a Postfix Calculator in Erlang
tags: erlang programming postfix
id: 168
excerpt: I've been messing around with IRC bots in different languages on and off for the last year, including a couple in Ruby (public broadcast messages for [USF CTF 2007](http://brycekerley.net/mp/2007/4/23/usf-ctf-2007) and a stevenote countdown timer), and more recently, "tostada," a multifunction one in Erlang, which now contains a full-blown programming language implementation.
filter: 
- markdown
blog_post: true
layout: post
created_at: 2008-01-06 02:59:17 -05:00
--- 
The Erlang one's functionality started pretty simply, as a bunch of hand-coded triggers and replies:
<pre class="textmate-source sunburst"><span class="source source_erlang"><span class="meta meta_function meta_function_erlang"><span class="entity entity_name entity_name_function entity_name_function_definition entity_name_function_definition_erlang">command</span><span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_begin punctuation_definition_parameters_begin_erlang">(</span><span class="string string_quoted string_quoted_double string_quoted_double_erlang"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_erlang">"</span>channel<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_erlang">"</span></span><span class="punctuation punctuation_separator punctuation_separator_parameters punctuation_separator_parameters_erlang">,</span><span class="variable variable_other variable_other_erlang">Cmd</span><span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_end punctuation_definition_parameters_end_erlang">)</span> <span class="punctuation punctuation_separator punctuation_separator_clause-head-body punctuation_separator_clause-head-body_erlang">-&gt;</span>
  <span class="meta meta_function-call meta_function-call_erlang">format<span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_begin punctuation_definition_parameters_begin_erlang">(</span><span class="string string_quoted string_quoted_double string_quoted_double_erlang"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_erlang">"</span>This is <span class="constant constant_other constant_other_placeholder constant_other_placeholder_erlang"><span class="punctuation punctuation_definition punctuation_definition_placeholder punctuation_definition_placeholder_erlang">~</span>p</span><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_erlang">"</span></span><span class="punctuation punctuation_separator punctuation_separator_parameters punctuation_separator_parameters_erlang">,</span><span class="meta meta_structure meta_structure_list meta_structure_list_erlang"><span class="punctuation punctuation_definition punctuation_definition_list punctuation_definition_list_begin punctuation_definition_list_begin_erlang">[</span><span class="variable variable_other variable_other_erlang">Cmd</span><span class="meta meta_record-usage meta_record-usage_erlang"><span class="keyword keyword_operator keyword_operator_record keyword_operator_record_erlang">#</span><span class="entity entity_name entity_name_type entity_name_type_class entity_name_type_class_record entity_name_type_class_record_erlang">toscmd</span><span class="punctuation punctuation_separator punctuation_separator_record-field punctuation_separator_record-field_erlang">.</span><span class="variable variable_other variable_other_field variable_other_field_erlang">channel</span></span><span class="punctuation punctuation_definition punctuation_definition_list punctuation_definition_list_end punctuation_definition_list_end_erlang">]</span></span><span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_end punctuation_definition_parameters_end_erlang">)</span></span><span class="punctuation punctuation_separator punctuation_separator_clauses punctuation_separator_clauses_erlang">;</span>
<span class="entity entity_name entity_name_function entity_name_function_erlang">command</span><span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_begin punctuation_definition_parameters_begin_erlang">(</span><span class="string string_quoted string_quoted_double string_quoted_double_erlang"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_erlang">"</span>version<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_erlang">"</span></span><span class="punctuation punctuation_separator punctuation_separator_parameters punctuation_separator_parameters_erlang">,</span><span class="variable variable_language variable_language_omitted variable_language_omitted_erlang">_</span><span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_end punctuation_definition_parameters_end_erlang">)</span> <span class="punctuation punctuation_separator punctuation_separator_clause-head-body punctuation_separator_clause-head-body_erlang">-&gt;</span>
  <span class="string string_quoted string_quoted_double string_quoted_double_erlang"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_erlang">"</span>I don't have a version.<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_erlang">"</span></span><span class="punctuation punctuation_separator punctuation_separator_clauses punctuation_separator_clauses_erlang">;</span>
<span class="entity entity_name entity_name_function entity_name_function_erlang">command</span><span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_begin punctuation_definition_parameters_begin_erlang">(</span><span class="string string_quoted string_quoted_double string_quoted_double_erlang"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_erlang">"</span>slavepid<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_erlang">"</span></span><span class="punctuation punctuation_separator punctuation_separator_parameters punctuation_separator_parameters_erlang">,</span><span class="variable variable_language variable_language_omitted variable_language_omitted_erlang">_</span><span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_end punctuation_definition_parameters_end_erlang">)</span> <span class="punctuation punctuation_separator punctuation_separator_clause-head-body punctuation_separator_clause-head-body_erlang">-&gt;</span>
  <span class="meta meta_function-call meta_function-call_erlang">format<span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_begin punctuation_definition_parameters_begin_erlang">(</span><span class="string string_quoted string_quoted_double string_quoted_double_erlang"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_erlang">"</span>I'm <span class="constant constant_other constant_other_placeholder constant_other_placeholder_erlang"><span class="punctuation punctuation_definition punctuation_definition_placeholder punctuation_definition_placeholder_erlang">~</span>p</span><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_erlang">"</span></span><span class="punctuation punctuation_separator punctuation_separator_parameters punctuation_separator_parameters_erlang">,</span> <span class="meta meta_structure meta_structure_list meta_structure_list_erlang"><span class="punctuation punctuation_definition punctuation_definition_list punctuation_definition_list_begin punctuation_definition_list_begin_erlang">[</span><span class="meta meta_function-call meta_function-call_erlang"><span class="entity entity_name entity_name_function entity_name_function_guard entity_name_function_guard_erlang">self</span><span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_begin punctuation_definition_parameters_begin_erlang">(</span><span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_end punctuation_definition_parameters_end_erlang">)</span></span><span class="punctuation punctuation_definition punctuation_definition_list punctuation_definition_list_end punctuation_definition_list_end_erlang">]</span></span><span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_end punctuation_definition_parameters_end_erlang">)</span></span><span class="punctuation punctuation_separator punctuation_separator_clauses punctuation_separator_clauses_erlang">;</span>
<span class="entity entity_name entity_name_function entity_name_function_erlang">command</span><span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_begin punctuation_definition_parameters_begin_erlang">(</span><span class="string string_quoted string_quoted_double string_quoted_double_erlang"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_erlang">"</span>whoami<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_erlang">"</span></span><span class="punctuation punctuation_separator punctuation_separator_parameters punctuation_separator_parameters_erlang">,</span><span class="variable variable_other variable_other_erlang">Cmd</span><span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_end punctuation_definition_parameters_end_erlang">)</span> <span class="punctuation punctuation_separator punctuation_separator_clause-head-body punctuation_separator_clause-head-body_erlang">-&gt;</span>
  <span class="meta meta_function-call meta_function-call_erlang">format<span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_begin punctuation_definition_parameters_begin_erlang">(</span><span class="string string_quoted string_quoted_double string_quoted_double_erlang"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_erlang">"</span>You're <span class="constant constant_other constant_other_placeholder constant_other_placeholder_erlang"><span class="punctuation punctuation_definition punctuation_definition_placeholder punctuation_definition_placeholder_erlang">~</span>p</span><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_erlang">"</span></span><span class="punctuation punctuation_separator punctuation_separator_parameters punctuation_separator_parameters_erlang">,</span> <span class="meta meta_structure meta_structure_list meta_structure_list_erlang"><span class="punctuation punctuation_definition punctuation_definition_list punctuation_definition_list_begin punctuation_definition_list_begin_erlang">[</span><span class="variable variable_other variable_other_erlang">Cmd</span><span class="meta meta_record-usage meta_record-usage_erlang"><span class="keyword keyword_operator keyword_operator_record keyword_operator_record_erlang">#</span><span class="entity entity_name entity_name_type entity_name_type_class entity_name_type_class_record entity_name_type_class_record_erlang">toscmd</span><span class="punctuation punctuation_separator punctuation_separator_record-field punctuation_separator_record-field_erlang">.</span><span class="variable variable_other variable_other_field variable_other_field_erlang">sender</span></span><span class="punctuation punctuation_definition punctuation_definition_list punctuation_definition_list_end punctuation_definition_list_end_erlang">]</span></span><span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_end punctuation_definition_parameters_end_erlang">)</span></span><span class="punctuation punctuation_separator punctuation_separator_clauses punctuation_separator_clauses_erlang">;</span>
<span class="entity entity_name entity_name_function entity_name_function_erlang">command</span><span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_begin punctuation_definition_parameters_begin_erlang">(</span><span class="string string_quoted string_quoted_double string_quoted_double_erlang"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_erlang">"</span>sleep<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_erlang">"</span></span><span class="punctuation punctuation_separator punctuation_separator_parameters punctuation_separator_parameters_erlang">,</span><span class="variable variable_other variable_other_erlang">Cmd</span><span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_end punctuation_definition_parameters_end_erlang">)</span> <span class="punctuation punctuation_separator punctuation_separator_clause-head-body punctuation_separator_clause-head-body_erlang">-&gt;</span>
  <span class="variable variable_other variable_other_erlang">Sleeptime</span> <span class="keyword keyword_operator keyword_operator_symbolic keyword_operator_symbolic_erlang">=</span> <span class="meta meta_function-call meta_function-call_erlang">list_to_integer<span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_begin punctuation_definition_parameters_begin_erlang">(</span><span class="meta meta_function-call meta_function-call_erlang"><span class="support support_other support_other_module support_other_module_erlang">lists</span><span class="punctuation punctuation_separator punctuation_separator_module-function punctuation_separator_module-function_erlang">:</span>nth<span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_begin punctuation_definition_parameters_begin_erlang">(</span><span class="constant constant_numeric constant_numeric_integer constant_numeric_integer_decimal constant_numeric_integer_decimal_erlang">1</span><span class="punctuation punctuation_separator punctuation_separator_parameters punctuation_separator_parameters_erlang">,</span> <span class="variable variable_other variable_other_erlang">Cmd</span><span class="meta meta_record-usage meta_record-usage_erlang"><span class="keyword keyword_operator keyword_operator_record keyword_operator_record_erlang">#</span><span class="entity entity_name entity_name_type entity_name_type_class entity_name_type_class_record entity_name_type_class_record_erlang">toscmd</span><span class="punctuation punctuation_separator punctuation_separator_record-field punctuation_separator_record-field_erlang">.</span><span class="variable variable_other variable_other_field variable_other_field_erlang">args</span></span><span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_end punctuation_definition_parameters_end_erlang">)</span></span><span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_end punctuation_definition_parameters_end_erlang">)</span></span><span class="punctuation punctuation_separator punctuation_separator_expressions punctuation_separator_expressions_erlang">,</span>
  <span class="meta meta_function-call meta_function-call_erlang"><span class="support support_other support_other_module support_other_module_erlang">timer</span><span class="punctuation punctuation_separator punctuation_separator_module-function punctuation_separator_module-function_erlang">:</span>sleep<span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_begin punctuation_definition_parameters_begin_erlang">(</span><span class="variable variable_other variable_other_erlang">Sleeptime</span><span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_end punctuation_definition_parameters_end_erlang">)</span></span><span class="punctuation punctuation_separator punctuation_separator_expressions punctuation_separator_expressions_erlang">,</span>
  <span class="meta meta_function-call meta_function-call_erlang">format<span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_begin punctuation_definition_parameters_begin_erlang">(</span><span class="string string_quoted string_quoted_double string_quoted_double_erlang"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_erlang">"</span>I am awake after sleeping <span class="constant constant_other constant_other_placeholder constant_other_placeholder_erlang"><span class="punctuation punctuation_definition punctuation_definition_placeholder punctuation_definition_placeholder_erlang">~</span>p</span><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_erlang">"</span></span><span class="punctuation punctuation_separator punctuation_separator_parameters punctuation_separator_parameters_erlang">,</span> <span class="meta meta_structure meta_structure_list meta_structure_list_erlang"><span class="punctuation punctuation_definition punctuation_definition_list punctuation_definition_list_begin punctuation_definition_list_begin_erlang">[</span><span class="variable variable_other variable_other_erlang">Sleeptime</span><span class="punctuation punctuation_definition punctuation_definition_list punctuation_definition_list_end punctuation_definition_list_end_erlang">]</span></span><span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_end punctuation_definition_parameters_end_erlang">)</span></span><span class="punctuation punctuation_separator punctuation_separator_clauses punctuation_separator_clauses_erlang">.</span></span></span></pre>

However, this seemed pretty anemic compared to the other bot in the channel, Shaniqua, which is basically a frontend for a programmable tcl interpreter, allowing it to do stuff as far-reaching as being a slot machine one second, and fetching stuff from Flickr the next.  I wanted tostada to not be completely worthless, but I also wanted it to be all-Erlang because I don't really know Erlang yet.

So I decided to write a stack-based programming language in Erlang, because this kind of language is quick and easy.  I called it "obscura" for reasons I've now forgotten.

# Erlang

Erlang is a functional programming language invented by Ericsson for reliable parallel programming.  To do this, it imposes certain constraints and supports certain conventions.

* The proper name for a function is `functionname/numargs`.  `multiply(X, Y) -> X*Y.` is named `multiply/2`.
* Functions can have multiple bodies.  Erlang selects the best one based on arguments as labeled, and guards (basically caveats, such as `double(X) when is_integer(X)` )  See `command/2` above for an example of a function selected on the value of its first argument.
* Statements in the same function body are separated with commas "`,`" ; multiple bodies for the same function are separated with semicolons "`;`" ; the last body of a function is terminated with a period "`.`" .  See `command/2` above for examples.
* Variables are scoped to the function they're in.  Global variables are discouraged, because they promote coupling.
* Matching is used instead of assignment.  `X = 42` succeeds if `X` is undefined or 42; fails otherwise.
* Variables are assigned once per function.  See previous bullet.
* In a function's arguments, `_` (underscore) is used to indicate an argument that you don't care about.  If you use a variable name, the compiler will whine if it's never used.  This is a good thing.
* If the last thing you do in a function is call another function, you don't create a new stack frame.  Thus, tail recursion is the preferred way to loop.

Example tail recursion:

<pre class="textmate-source sunburst"><span class="source source_erlang"><span class="meta meta_function meta_function_erlang"><span class="entity entity_name entity_name_function entity_name_function_definition entity_name_function_definition_erlang">sum</span><span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_begin punctuation_definition_parameters_begin_erlang">(</span><span class="variable variable_other variable_other_erlang">List</span><span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_end punctuation_definition_parameters_end_erlang">)</span> <span class="punctuation punctuation_separator punctuation_separator_clause-head-body punctuation_separator_clause-head-body_erlang">-&gt;</span> <span class="meta meta_function-call meta_function-call_erlang">sum<span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_begin punctuation_definition_parameters_begin_erlang">(</span><span class="variable variable_other variable_other_erlang">List</span><span class="punctuation punctuation_separator punctuation_separator_parameters punctuation_separator_parameters_erlang">,</span> <span class="constant constant_numeric constant_numeric_integer constant_numeric_integer_decimal constant_numeric_integer_decimal_erlang">0</span><span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_end punctuation_definition_parameters_end_erlang">)</span></span><span class="punctuation punctuation_terminator punctuation_terminator_function punctuation_terminator_function_erlang">.</span></span>
<span class="meta meta_function meta_function_erlang"><span class="entity entity_name entity_name_function entity_name_function_definition entity_name_function_definition_erlang">sum</span><span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_begin punctuation_definition_parameters_begin_erlang">(</span><span class="meta meta_structure meta_structure_list meta_structure_list_erlang"><span class="punctuation punctuation_definition punctuation_definition_list punctuation_definition_list_begin punctuation_definition_list_begin_erlang">[</span><span class="punctuation punctuation_definition punctuation_definition_list punctuation_definition_list_end punctuation_definition_list_end_erlang">]</span></span><span class="punctuation punctuation_separator punctuation_separator_parameters punctuation_separator_parameters_erlang">,</span> <span class="variable variable_other variable_other_erlang">Tot</span><span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_end punctuation_definition_parameters_end_erlang">)</span> <span class="punctuation punctuation_separator punctuation_separator_clause-head-body punctuation_separator_clause-head-body_erlang">-&gt;</span> <span class="comment comment_line comment_line_erlang"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_erlang">%</span> base case - empty list
</span>  <span class="variable variable_other variable_other_erlang">Tot</span><span class="punctuation punctuation_separator punctuation_separator_clauses punctuation_separator_clauses_erlang">;</span>
<span class="entity entity_name entity_name_function entity_name_function_erlang">sum</span><span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_begin punctuation_definition_parameters_begin_erlang">(</span><span class="meta meta_structure meta_structure_list meta_structure_list_erlang"><span class="punctuation punctuation_definition punctuation_definition_list punctuation_definition_list_begin punctuation_definition_list_begin_erlang">[</span><span class="variable variable_other variable_other_erlang">Car</span><span class="punctuation punctuation_separator punctuation_separator_list punctuation_separator_list_erlang">|</span><span class="variable variable_other variable_other_erlang">Cdr</span><span class="punctuation punctuation_definition punctuation_definition_list punctuation_definition_list_end punctuation_definition_list_end_erlang">]</span></span><span class="punctuation punctuation_separator punctuation_separator_parameters punctuation_separator_parameters_erlang">,</span> <span class="variable variable_other variable_other_erlang">Tot</span><span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_end punctuation_definition_parameters_end_erlang">)</span> <span class="punctuation punctuation_separator punctuation_separator_clause-head-body punctuation_separator_clause-head-body_erlang">-&gt;</span> <span class="comment comment_line comment_line_erlang"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_erlang">%</span> add current entry to running total
</span>  <span class="meta meta_function-call meta_function-call_erlang">sum<span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_begin punctuation_definition_parameters_begin_erlang">(</span><span class="variable variable_other variable_other_erlang">Cdr</span><span class="punctuation punctuation_separator punctuation_separator_parameters punctuation_separator_parameters_erlang">,</span> <span class="variable variable_other variable_other_erlang">Tot</span> <span class="keyword keyword_operator keyword_operator_symbolic keyword_operator_symbolic_erlang">+</span> <span class="variable variable_other variable_other_erlang">Cdr</span><span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_end punctuation_definition_parameters_end_erlang">)</span></span><span class="punctuation punctuation_terminator punctuation_terminator_function punctuation_terminator_function_erlang">.</span></span></span>
</pre>

Note the use of a running total argument to `sum/2`.  This is necessary because simply returning `sum(Cdr) + Car` will leave the current call on the stack, taking up more memory.

Erlang has quite usable documentation available online at [http://www.erlang.org/doc/](http://www.erlang.org/doc/), and is [free to download](http://www.erlang.org/download.html) for most modern operating systems, and Windows too.

# Parsing

You only need to parse two things to do simple arithmetic operations: integers and operators.  Likewise, the only state you need to hold boils down to the remaining program and the current state of the stack.  Let's parse first, so we have something to test operators with.

We start off with basically a blank slate:

<pre class="textmate-source sunburst"><span class="source source_erlang"><span class="meta meta_directive meta_directive_module meta_directive_module_erlang"><span class="punctuation punctuation_section punctuation_section_directive punctuation_section_directive_begin punctuation_section_directive_begin_erlang">-</span><span class="keyword keyword_control keyword_control_directive keyword_control_directive_module keyword_control_directive_module_erlang">module</span> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_begin punctuation_definition_parameters_begin_erlang">(</span><span class="support support_other support_other_module support_other_module_definition support_other_module_definition_erlang">obscura</span><span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_end punctuation_definition_parameters_end_erlang">)</span><span class="punctuation punctuation_section punctuation_section_directive punctuation_section_directive_end punctuation_section_directive_end_erlang">.</span></span>
<span class="meta meta_directive meta_directive_erlang"><span class="punctuation punctuation_section punctuation_section_directive punctuation_section_directive_begin punctuation_section_directive_begin_erlang">-</span><span class="keyword keyword_control keyword_control_directive keyword_control_directive_erlang">author</span> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_begin punctuation_definition_parameters_begin_erlang">(</span><span class="string string_quoted string_quoted_double string_quoted_double_erlang"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_erlang">"</span>bkerley@brycekerley.net<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_erlang">"</span></span><span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_end punctuation_definition_parameters_end_erlang">)</span><span class="punctuation punctuation_section punctuation_section_directive punctuation_section_directive_end punctuation_section_directive_end_erlang">.</span></span>
<span class="meta meta_directive meta_directive_erlang"><span class="punctuation punctuation_section punctuation_section_directive punctuation_section_directive_begin punctuation_section_directive_begin_erlang">-</span><span class="keyword keyword_control keyword_control_directive keyword_control_directive_erlang">include</span> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_begin punctuation_definition_parameters_begin_erlang">(</span><span class="string string_quoted string_quoted_double string_quoted_double_erlang"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_erlang">"</span>command.hrl<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_erlang">"</span></span><span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_end punctuation_definition_parameters_end_erlang">)</span><span class="punctuation punctuation_section punctuation_section_directive punctuation_section_directive_end punctuation_section_directive_end_erlang">.</span></span>
<span class="meta meta_directive meta_directive_export meta_directive_export_erlang"><span class="punctuation punctuation_section punctuation_section_directive punctuation_section_directive_begin punctuation_section_directive_begin_erlang">-</span><span class="keyword keyword_control keyword_control_directive keyword_control_directive_export keyword_control_directive_export_erlang">export</span> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_begin punctuation_definition_parameters_begin_erlang">(</span><span class="meta meta_structure meta_structure_list meta_structure_list_function meta_structure_list_function_erlang"><span class="punctuation punctuation_definition punctuation_definition_list punctuation_definition_list_begin punctuation_definition_list_begin_erlang">[</span><span class="entity entity_name entity_name_function entity_name_function_erlang">eval</span><span class="punctuation punctuation_separator punctuation_separator_function-arity punctuation_separator_function-arity_erlang">/</span><span class="constant constant_numeric constant_numeric_integer constant_numeric_integer_decimal constant_numeric_integer_decimal_erlang">1</span><span class="punctuation punctuation_definition punctuation_definition_list punctuation_definition_list_end punctuation_definition_list_end_erlang">]</span></span><span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_end punctuation_definition_parameters_end_erlang">)</span><span class="punctuation punctuation_section punctuation_section_directive punctuation_section_directive_end punctuation_section_directive_end_erlang">.</span></span>
<span class="meta meta_directive meta_directive_import meta_directive_import_erlang"><span class="punctuation punctuation_section punctuation_section_directive punctuation_section_directive_begin punctuation_section_directive_begin_erlang">-</span><span class="keyword keyword_control keyword_control_directive keyword_control_directive_import keyword_control_directive_import_erlang">import</span> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_begin punctuation_definition_parameters_begin_erlang">(</span><span class="support support_other support_other_module support_other_module_erlang">io_lib</span><span class="punctuation punctuation_separator punctuation_separator_parameters punctuation_separator_parameters_erlang">,</span> <span class="meta meta_structure meta_structure_list meta_structure_list_function meta_structure_list_function_erlang"><span class="punctuation punctuation_definition punctuation_definition_list punctuation_definition_list_begin punctuation_definition_list_begin_erlang">[</span><span class="entity entity_name entity_name_function entity_name_function_erlang">format</span><span class="punctuation punctuation_separator punctuation_separator_function-arity punctuation_separator_function-arity_erlang">/</span><span class="constant constant_numeric constant_numeric_integer constant_numeric_integer_decimal constant_numeric_integer_decimal_erlang">2</span><span class="punctuation punctuation_definition punctuation_definition_list punctuation_definition_list_end punctuation_definition_list_end_erlang">]</span></span><span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_end punctuation_definition_parameters_end_erlang">)</span><span class="punctuation punctuation_section punctuation_section_directive punctuation_section_directive_end punctuation_section_directive_end_erlang">.</span></span>

<span class="meta meta_function meta_function_erlang"><span class="entity entity_name entity_name_function entity_name_function_definition entity_name_function_definition_erlang">eval</span><span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_begin punctuation_definition_parameters_begin_erlang">(</span><span class="variable variable_other variable_other_erlang">Line</span><span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_end punctuation_definition_parameters_end_erlang">)</span> <span class="punctuation punctuation_separator punctuation_separator_clause-head-body punctuation_separator_clause-head-body_erlang">-&gt;</span>
  <span class="meta meta_function-call meta_function-call_erlang">format<span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_begin punctuation_definition_parameters_begin_erlang">(</span><span class="string string_quoted string_quoted_double string_quoted_double_erlang"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_erlang">"</span><span class="constant constant_other constant_other_placeholder constant_other_placeholder_erlang"><span class="punctuation punctuation_definition punctuation_definition_placeholder punctuation_definition_placeholder_erlang">~</span>p</span><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_erlang">"</span></span><span class="punctuation punctuation_separator punctuation_separator_parameters punctuation_separator_parameters_erlang">,</span><span class="meta meta_structure meta_structure_list meta_structure_list_erlang"><span class="punctuation punctuation_definition punctuation_definition_list punctuation_definition_list_begin punctuation_definition_list_begin_erlang">[</span><span class="variable variable_other variable_other_erlang">Line</span><span class="punctuation punctuation_definition punctuation_definition_list punctuation_definition_list_end punctuation_definition_list_end_erlang">]</span></span><span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_end punctuation_definition_parameters_end_erlang">)</span></span><span class="punctuation punctuation_terminator punctuation_terminator_function punctuation_terminator_function_erlang">.</span></span></span>
</pre>

At this point, we can call `obscura:eval("3 4 +")` and get out√â what we entered.  For simplicity's sake, we can write a parser in two steps:

1. Split the line with `string:tokens/2` into an array of words.
2. Convert each word to an integer.  Failing that, leave it as a string.

And coded:
<pre class="textmate-source sunburst"><span class="source source_erlang"><span class="meta meta_function meta_function_erlang"><span class="entity entity_name entity_name_function entity_name_function_definition entity_name_function_definition_erlang">eval</span><span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_begin punctuation_definition_parameters_begin_erlang">(</span><span class="variable variable_other variable_other_erlang">Line</span><span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_end punctuation_definition_parameters_end_erlang">)</span> <span class="punctuation punctuation_separator punctuation_separator_clause-head-body punctuation_separator_clause-head-body_erlang">-&gt;</span>
  <span class="variable variable_other variable_other_erlang">Nodes</span> <span class="keyword keyword_operator keyword_operator_symbolic keyword_operator_symbolic_erlang">=</span> <span class="meta meta_function-call meta_function-call_erlang">integerize<span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_begin punctuation_definition_parameters_begin_erlang">(</span><span class="meta meta_function-call meta_function-call_erlang"><span class="support support_other support_other_module support_other_module_erlang">string</span><span class="punctuation punctuation_separator punctuation_separator_module-function punctuation_separator_module-function_erlang">:</span>tokens<span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_begin punctuation_definition_parameters_begin_erlang">(</span><span class="variable variable_other variable_other_erlang">Line</span><span class="punctuation punctuation_separator punctuation_separator_parameters punctuation_separator_parameters_erlang">,</span> <span class="string string_quoted string_quoted_double string_quoted_double_erlang"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_erlang">"</span> <span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_erlang">"</span></span><span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_end punctuation_definition_parameters_end_erlang">)</span></span><span class="punctuation punctuation_separator punctuation_separator_parameters punctuation_separator_parameters_erlang">,</span> <span class="meta meta_structure meta_structure_list meta_structure_list_erlang"><span class="punctuation punctuation_definition punctuation_definition_list punctuation_definition_list_begin punctuation_definition_list_begin_erlang">[</span><span class="punctuation punctuation_definition punctuation_definition_list punctuation_definition_list_end punctuation_definition_list_end_erlang">]</span></span><span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_end punctuation_definition_parameters_end_erlang">)</span></span><span class="punctuation punctuation_separator punctuation_separator_expressions punctuation_separator_expressions_erlang">,</span>
  <span class="meta meta_function-call meta_function-call_erlang">format<span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_begin punctuation_definition_parameters_begin_erlang">(</span><span class="string string_quoted string_quoted_double string_quoted_double_erlang"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_erlang">"</span><span class="constant constant_other constant_other_placeholder constant_other_placeholder_erlang"><span class="punctuation punctuation_definition punctuation_definition_placeholder punctuation_definition_placeholder_erlang">~</span>p</span><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_erlang">"</span></span><span class="punctuation punctuation_separator punctuation_separator_parameters punctuation_separator_parameters_erlang">,</span><span class="meta meta_structure meta_structure_list meta_structure_list_erlang"><span class="punctuation punctuation_definition punctuation_definition_list punctuation_definition_list_begin punctuation_definition_list_begin_erlang">[</span><span class="variable variable_other variable_other_erlang">Nodes</span><span class="punctuation punctuation_definition punctuation_definition_list punctuation_definition_list_end punctuation_definition_list_end_erlang">]</span></span><span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_end punctuation_definition_parameters_end_erlang">)</span></span><span class="punctuation punctuation_terminator punctuation_terminator_function punctuation_terminator_function_erlang">.</span></span>

<span class="meta meta_function meta_function_erlang"><span class="entity entity_name entity_name_function entity_name_function_definition entity_name_function_definition_erlang">integerize</span><span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_begin punctuation_definition_parameters_begin_erlang">(</span><span class="meta meta_structure meta_structure_list meta_structure_list_erlang"><span class="punctuation punctuation_definition punctuation_definition_list punctuation_definition_list_begin punctuation_definition_list_begin_erlang">[</span><span class="punctuation punctuation_definition punctuation_definition_list punctuation_definition_list_end punctuation_definition_list_end_erlang">]</span></span><span class="punctuation punctuation_separator punctuation_separator_parameters punctuation_separator_parameters_erlang">,</span><span class="variable variable_other variable_other_erlang">Accum</span><span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_end punctuation_definition_parameters_end_erlang">)</span> <span class="punctuation punctuation_separator punctuation_separator_clause-head-body punctuation_separator_clause-head-body_erlang">-&gt;</span>
  <span class="meta meta_function-call meta_function-call_erlang"><span class="support support_other support_other_module support_other_module_erlang">lists</span><span class="punctuation punctuation_separator punctuation_separator_module-function punctuation_separator_module-function_erlang">:</span>reverse<span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_begin punctuation_definition_parameters_begin_erlang">(</span><span class="variable variable_other variable_other_erlang">Accum</span><span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_end punctuation_definition_parameters_end_erlang">)</span></span><span class="punctuation punctuation_separator punctuation_separator_clauses punctuation_separator_clauses_erlang">;</span>
<span class="entity entity_name entity_name_function entity_name_function_erlang">integerize</span><span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_begin punctuation_definition_parameters_begin_erlang">(</span><span class="meta meta_structure meta_structure_list meta_structure_list_erlang"><span class="punctuation punctuation_definition punctuation_definition_list punctuation_definition_list_begin punctuation_definition_list_begin_erlang">[</span><span class="variable variable_other variable_other_erlang">First</span><span class="punctuation punctuation_separator punctuation_separator_list punctuation_separator_list_erlang">|</span><span class="variable variable_other variable_other_erlang">Rest</span><span class="punctuation punctuation_definition punctuation_definition_list punctuation_definition_list_end punctuation_definition_list_end_erlang">]</span></span><span class="punctuation punctuation_separator punctuation_separator_parameters punctuation_separator_parameters_erlang">,</span> <span class="variable variable_other variable_other_erlang">Accum</span><span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_end punctuation_definition_parameters_end_erlang">)</span> <span class="punctuation punctuation_separator punctuation_separator_clause-head-body punctuation_separator_clause-head-body_erlang">-&gt;</span>
  <span class="meta meta_function-call meta_function-call_erlang">integerize<span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_begin punctuation_definition_parameters_begin_erlang">(</span><span class="variable variable_other variable_other_erlang">Rest</span><span class="punctuation punctuation_separator punctuation_separator_parameters punctuation_separator_parameters_erlang">,</span> <span class="meta meta_structure meta_structure_list meta_structure_list_erlang"><span class="punctuation punctuation_definition punctuation_definition_list punctuation_definition_list_begin punctuation_definition_list_begin_erlang">[</span><span class="meta meta_function-call meta_function-call_erlang">try_integerize<span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_begin punctuation_definition_parameters_begin_erlang">(</span><span class="variable variable_other variable_other_erlang">First</span><span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_end punctuation_definition_parameters_end_erlang">)</span></span><span class="punctuation punctuation_separator punctuation_separator_list punctuation_separator_list_erlang">|</span><span class="variable variable_other variable_other_erlang">Accum</span><span class="punctuation punctuation_definition punctuation_definition_list punctuation_definition_list_end punctuation_definition_list_end_erlang">]</span></span><span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_end punctuation_definition_parameters_end_erlang">)</span></span><span class="punctuation punctuation_terminator punctuation_terminator_function punctuation_terminator_function_erlang">.</span></span>

<span class="meta meta_function meta_function_erlang"><span class="entity entity_name entity_name_function entity_name_function_definition entity_name_function_definition_erlang">try_integerize</span><span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_begin punctuation_definition_parameters_begin_erlang">(</span><span class="variable variable_other variable_other_erlang">Candidate</span><span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_end punctuation_definition_parameters_end_erlang">)</span> <span class="punctuation punctuation_separator punctuation_separator_clause-head-body punctuation_separator_clause-head-body_erlang">-&gt;</span>
  <span class="meta meta_expression meta_expression_try meta_expression_try_erlang"><span class="keyword keyword_control keyword_control_try keyword_control_try_erlang">try</span>
    <span class="meta meta_function-call meta_function-call_erlang">list_to_integer<span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_begin punctuation_definition_parameters_begin_erlang">(</span><span class="variable variable_other variable_other_erlang">Candidate</span><span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_end punctuation_definition_parameters_end_erlang">)</span></span>
  <span class="keyword keyword_control keyword_control_erlang">catch</span>
    <span class="constant constant_other constant_other_symbol constant_other_symbol_unquoted constant_other_symbol_unquoted_erlang">error</span>:<span class="variable variable_language variable_language_omitted variable_language_omitted_erlang">_</span> <span class="punctuation punctuation_separator punctuation_separator_clause-head-body punctuation_separator_clause-head-body_erlang">-&gt;</span>
      <span class="variable variable_other variable_other_erlang">Candidate</span>
  <span class="keyword keyword_control keyword_control_end keyword_control_end_erlang">end</span></span><span class="punctuation punctuation_terminator punctuation_terminator_function punctuation_terminator_function_erlang">.</span></span></span>
</pre>

`integerize/2` is the recursive conversion function.  Since Erlang optimizes tail recursion, and it uses a singly-linked list for everything, we don't want to traverse to the end of the array every step (an O(N) operation each time, or O(N<sup>2</sup>) for the whole line), simply tacking new entries on at the beginning (an O(1) operation each time), and reverse it at the end (so the whole line is O(N), much better).

`try_integerize/1` is 

Now, when `eval`ing "3 4 +", we get an array containing 3, 4, and "+".  That's the easy part, so on to the fun part.

# Arithmetic

`eval/1` needs to call a function to actually turn the parsed array into results, which I'll call `eval/2`.  `eval/2` will be recursive (tail-recursive, so we don't blow up the stack), so it needs our two state elements from before as arguments - remaining line, and current stack.  New version of `eval/1` that calls `eval/2`:

<pre class="textmate-source sunburst"><span class="source source_erlang"><span class="meta meta_function meta_function_erlang"><span class="entity entity_name entity_name_function entity_name_function_definition entity_name_function_definition_erlang">eval</span><span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_begin punctuation_definition_parameters_begin_erlang">(</span><span class="variable variable_other variable_other_erlang">Line</span><span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_end punctuation_definition_parameters_end_erlang">)</span> <span class="punctuation punctuation_separator punctuation_separator_clause-head-body punctuation_separator_clause-head-body_erlang">-&gt;</span>
  <span class="variable variable_other variable_other_erlang">Nodes</span> <span class="keyword keyword_operator keyword_operator_symbolic keyword_operator_symbolic_erlang">=</span> <span class="meta meta_function-call meta_function-call_erlang">integerize<span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_begin punctuation_definition_parameters_begin_erlang">(</span><span class="meta meta_function-call meta_function-call_erlang"><span class="support support_other support_other_module support_other_module_erlang">string</span><span class="punctuation punctuation_separator punctuation_separator_module-function punctuation_separator_module-function_erlang">:</span>tokens<span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_begin punctuation_definition_parameters_begin_erlang">(</span><span class="variable variable_other variable_other_erlang">Line</span><span class="punctuation punctuation_separator punctuation_separator_parameters punctuation_separator_parameters_erlang">,</span> <span class="string string_quoted string_quoted_double string_quoted_double_erlang"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_erlang">"</span> <span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_erlang">"</span></span><span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_end punctuation_definition_parameters_end_erlang">)</span></span><span class="punctuation punctuation_separator punctuation_separator_parameters punctuation_separator_parameters_erlang">,</span> <span class="meta meta_structure meta_structure_list meta_structure_list_erlang"><span class="punctuation punctuation_definition punctuation_definition_list punctuation_definition_list_begin punctuation_definition_list_begin_erlang">[</span><span class="punctuation punctuation_definition punctuation_definition_list punctuation_definition_list_end punctuation_definition_list_end_erlang">]</span></span><span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_end punctuation_definition_parameters_end_erlang">)</span></span><span class="punctuation punctuation_separator punctuation_separator_expressions punctuation_separator_expressions_erlang">,</span>
  <span class="meta meta_function-call meta_function-call_erlang">eval<span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_begin punctuation_definition_parameters_begin_erlang">(</span><span class="variable variable_other variable_other_erlang">Nodes</span><span class="punctuation punctuation_separator punctuation_separator_parameters punctuation_separator_parameters_erlang">,</span> <span class="meta meta_structure meta_structure_list meta_structure_list_erlang"><span class="punctuation punctuation_definition punctuation_definition_list punctuation_definition_list_begin punctuation_definition_list_begin_erlang">[</span><span class="punctuation punctuation_definition punctuation_definition_list punctuation_definition_list_end punctuation_definition_list_end_erlang">]</span></span><span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_end punctuation_definition_parameters_end_erlang">)</span></span><span class="punctuation punctuation_terminator punctuation_terminator_function punctuation_terminator_function_erlang">.</span></span></span>
</pre>

## Pushing to the stack

Let's implement the "push" operation since it's simple.  When the first word in the remaining line is an integer, put it at the beginning of the stack array.

<pre class="textmate-source sunburst"><span class="source source_erlang"><span class="meta meta_function meta_function_erlang"><span class="entity entity_name entity_name_function entity_name_function_definition entity_name_function_definition_erlang">eval</span><span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_begin punctuation_definition_parameters_begin_erlang">(</span><span class="meta meta_structure meta_structure_list meta_structure_list_erlang"><span class="punctuation punctuation_definition punctuation_definition_list punctuation_definition_list_begin punctuation_definition_list_begin_erlang">[</span><span class="variable variable_other variable_other_erlang">First</span><span class="punctuation punctuation_separator punctuation_separator_list punctuation_separator_list_erlang">|</span><span class="variable variable_other variable_other_erlang">Rest</span><span class="punctuation punctuation_definition punctuation_definition_list punctuation_definition_list_end punctuation_definition_list_end_erlang">]</span></span><span class="punctuation punctuation_separator punctuation_separator_parameters punctuation_separator_parameters_erlang">,</span> <span class="variable variable_other variable_other_erlang">Stack</span><span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_end punctuation_definition_parameters_end_erlang">)</span> <span class="keyword keyword_control keyword_control_erlang">when</span> <span class="meta meta_function-call meta_function-call_erlang"><span class="entity entity_name entity_name_function entity_name_function_guard entity_name_function_guard_erlang">is_integer</span><span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_begin punctuation_definition_parameters_begin_erlang">(</span><span class="variable variable_other variable_other_erlang">First</span><span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_end punctuation_definition_parameters_end_erlang">)</span></span> <span class="punctuation punctuation_separator punctuation_separator_clause-head-body punctuation_separator_clause-head-body_erlang">-&gt;</span> <span class="comment comment_line comment_line_erlang"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_erlang">%</span> push
</span>  <span class="meta meta_function-call meta_function-call_erlang">eval<span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_begin punctuation_definition_parameters_begin_erlang">(</span><span class="variable variable_other variable_other_erlang">Rest</span><span class="punctuation punctuation_separator punctuation_separator_parameters punctuation_separator_parameters_erlang">,</span> <span class="meta meta_structure meta_structure_list meta_structure_list_erlang"><span class="punctuation punctuation_definition punctuation_definition_list punctuation_definition_list_begin punctuation_definition_list_begin_erlang">[</span><span class="variable variable_other variable_other_erlang">First</span><span class="punctuation punctuation_separator punctuation_separator_list punctuation_separator_list_erlang">|</span><span class="variable variable_other variable_other_erlang">Stack</span><span class="punctuation punctuation_definition punctuation_definition_list punctuation_definition_list_end punctuation_definition_list_end_erlang">]</span></span><span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_end punctuation_definition_parameters_end_erlang">)</span></span><span class="punctuation punctuation_separator punctuation_separator_clauses punctuation_separator_clauses_erlang">;</span></span></span>
</pre>

## Cars and Cdrs

This might be your first time with Erlang's `car`/`cdr` equivalent, and guard expression.  Basically, `[First|Rest]` is the expression for a list with first element in the `First` variable, and the sublist of every other element in the `Last` variable.

<pre class="textmate-source sunburst"><span class="source source_erlang"><span class="variable variable_other variable_other_erlang">Array</span> <span class="keyword keyword_operator keyword_operator_symbolic keyword_operator_symbolic_erlang">=</span> <span class="meta meta_structure meta_structure_list meta_structure_list_erlang"><span class="punctuation punctuation_definition punctuation_definition_list punctuation_definition_list_begin punctuation_definition_list_begin_erlang">[</span><span class="constant constant_numeric constant_numeric_integer constant_numeric_integer_decimal constant_numeric_integer_decimal_erlang">1</span><span class="punctuation punctuation_separator punctuation_separator_list punctuation_separator_list_erlang">,</span> <span class="constant constant_numeric constant_numeric_integer constant_numeric_integer_decimal constant_numeric_integer_decimal_erlang">2</span><span class="punctuation punctuation_separator punctuation_separator_list punctuation_separator_list_erlang">,</span> <span class="constant constant_numeric constant_numeric_integer constant_numeric_integer_decimal constant_numeric_integer_decimal_erlang">3</span><span class="punctuation punctuation_separator punctuation_separator_list punctuation_separator_list_erlang">,</span> <span class="constant constant_numeric constant_numeric_integer constant_numeric_integer_decimal constant_numeric_integer_decimal_erlang">4</span><span class="punctuation punctuation_definition punctuation_definition_list punctuation_definition_list_end punctuation_definition_list_end_erlang">]</span></span>,
<span class="meta meta_structure meta_structure_list meta_structure_list_erlang"><span class="punctuation punctuation_definition punctuation_definition_list punctuation_definition_list_begin punctuation_definition_list_begin_erlang">[</span><span class="variable variable_other variable_other_erlang">First</span><span class="punctuation punctuation_separator punctuation_separator_list punctuation_separator_list_erlang">|</span><span class="variable variable_other variable_other_erlang">Rest</span><span class="punctuation punctuation_definition punctuation_definition_list punctuation_definition_list_end punctuation_definition_list_end_erlang">]</span></span> <span class="keyword keyword_operator keyword_operator_symbolic keyword_operator_symbolic_erlang">=</span> <span class="variable variable_other variable_other_erlang">Array</span>,
<span class="variable variable_other variable_other_erlang">First</span> <span class="keyword keyword_operator keyword_operator_symbolic keyword_operator_symbolic_erlang">=</span> <span class="constant constant_numeric constant_numeric_integer constant_numeric_integer_decimal constant_numeric_integer_decimal_erlang">1</span>,
<span class="variable variable_other variable_other_erlang">Rest</span> <span class="keyword keyword_operator keyword_operator_symbolic keyword_operator_symbolic_erlang">=</span> <span class="meta meta_structure meta_structure_list meta_structure_list_erlang"><span class="punctuation punctuation_definition punctuation_definition_list punctuation_definition_list_begin punctuation_definition_list_begin_erlang">[</span><span class="constant constant_numeric constant_numeric_integer constant_numeric_integer_decimal constant_numeric_integer_decimal_erlang">2</span><span class="punctuation punctuation_separator punctuation_separator_list punctuation_separator_list_erlang">,</span> <span class="constant constant_numeric constant_numeric_integer constant_numeric_integer_decimal constant_numeric_integer_decimal_erlang">3</span><span class="punctuation punctuation_separator punctuation_separator_list punctuation_separator_list_erlang">,</span> <span class="constant constant_numeric constant_numeric_integer constant_numeric_integer_decimal constant_numeric_integer_decimal_erlang">4</span><span class="punctuation punctuation_definition punctuation_definition_list punctuation_definition_list_end punctuation_definition_list_end_erlang">]</span></span>.
<span class="comment comment_line comment_line_erlang"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_erlang">%</span> if you flip line 2 and run this code backwards it'll  be successful :D</span></span>
</pre>

## Printing results

With the code so far, as soon as we run out of words in the line, we'll error out with a `badmatch` error (Erlang couldn't find an appropriate function body for our arguments).  Let's just return the `Stack` when our array of remaining words is empty.

<pre class="textmate-source sunburst"><span class="source source_erlang"><span class="meta meta_function meta_function_erlang"><span class="entity entity_name entity_name_function entity_name_function_erlang">eval</span><span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_begin punctuation_definition_parameters_begin_erlang">(</span><span class="meta meta_structure meta_structure_list meta_structure_list_erlang"><span class="punctuation punctuation_definition punctuation_definition_list punctuation_definition_list_begin punctuation_definition_list_begin_erlang">[</span><span class="punctuation punctuation_definition punctuation_definition_list punctuation_definition_list_end punctuation_definition_list_end_erlang">]</span></span><span class="punctuation punctuation_separator punctuation_separator_parameters punctuation_separator_parameters_erlang">,</span> <span class="variable variable_other variable_other_erlang">Stack</span><span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_end punctuation_definition_parameters_end_erlang">)</span> <span class="punctuation punctuation_separator punctuation_separator_clause-head-body punctuation_separator_clause-head-body_erlang">-&gt;</span> <span class="comment comment_line comment_line_erlang"><span class="punctuation punctuation_definition punctuation_definition_comment punctuation_definition_comment_erlang">%</span> no more ops, dump stack
</span>  <span class="variable variable_other variable_other_erlang">Stack</span><span class="punctuation punctuation_separator punctuation_separator_clauses punctuation_separator_clauses_erlang">;</span></span></span>
</pre>

## Base case and fallback

Right now, if we do anything other than pushing an integer to the stack or running out of remaining words, Erlang will fail and dump a `badmatch` error report to your screen.

Oops.  Let's add a base case that'll match every word that hasn't already been matched with an appropriate operation.

<pre class="textmate-source sunburst"><span class="source source_erlang"><span class="meta meta_function meta_function_erlang"><span class="entity entity_name entity_name_function entity_name_function_erlang">eval</span><span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_begin punctuation_definition_parameters_begin_erlang">(</span><span class="meta meta_structure meta_structure_list meta_structure_list_erlang"><span class="punctuation punctuation_definition punctuation_definition_list punctuation_definition_list_begin punctuation_definition_list_begin_erlang">[</span><span class="variable variable_other variable_other_erlang">Invalid</span><span class="punctuation punctuation_separator punctuation_separator_list punctuation_separator_list_erlang">|</span><span class="variable variable_other variable_other_erlang">Rest</span><span class="punctuation punctuation_definition punctuation_definition_list punctuation_definition_list_end punctuation_definition_list_end_erlang">]</span></span><span class="punctuation punctuation_separator punctuation_separator_parameters punctuation_separator_parameters_erlang">,</span> <span class="variable variable_other variable_other_erlang">Stack</span><span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_end punctuation_definition_parameters_end_erlang">)</span> <span class="punctuation punctuation_separator punctuation_separator_clause-head-body punctuation_separator_clause-head-body_erlang">-&gt;</span>
  <span class="meta meta_function-call meta_function-call_erlang">format<span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_begin punctuation_definition_parameters_begin_erlang">(</span><span class="string string_quoted string_quoted_double string_quoted_double_erlang"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_erlang">"</span>Invalid opcode <span class="constant constant_character constant_character_escape constant_character_escape_erlang"><span class="punctuation punctuation_definition punctuation_definition_escape punctuation_definition_escape_erlang">\</span>"</span><span class="constant constant_other constant_other_placeholder constant_other_placeholder_erlang"><span class="punctuation punctuation_definition punctuation_definition_placeholder punctuation_definition_placeholder_erlang">~</span>s</span><span class="constant constant_character constant_character_escape constant_character_escape_erlang"><span class="punctuation punctuation_definition punctuation_definition_escape punctuation_definition_escape_erlang">\</span>"</span>.  Rest: <span class="constant constant_other constant_other_placeholder constant_other_placeholder_erlang"><span class="punctuation punctuation_definition punctuation_definition_placeholder punctuation_definition_placeholder_erlang">~</span>w</span> Stack: <span class="constant constant_other constant_other_placeholder constant_other_placeholder_erlang"><span class="punctuation punctuation_definition punctuation_definition_placeholder punctuation_definition_placeholder_erlang">~</span>w</span><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_erlang">"</span></span><span class="punctuation punctuation_separator punctuation_separator_parameters punctuation_separator_parameters_erlang">,</span><span class="meta meta_structure meta_structure_list meta_structure_list_erlang"><span class="punctuation punctuation_definition punctuation_definition_list punctuation_definition_list_begin punctuation_definition_list_begin_erlang">[</span><span class="variable variable_other variable_other_erlang">Invalid</span><span class="punctuation punctuation_separator punctuation_separator_list punctuation_separator_list_erlang">,</span> <span class="variable variable_other variable_other_erlang">Rest</span><span class="punctuation punctuation_separator punctuation_separator_list punctuation_separator_list_erlang">,</span> <span class="variable variable_other variable_other_erlang">Stack</span><span class="punctuation punctuation_definition punctuation_definition_list punctuation_definition_list_end punctuation_definition_list_end_erlang">]</span></span><span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_end punctuation_definition_parameters_end_erlang">)</span></span><span class="punctuation punctuation_terminator punctuation_terminator_function punctuation_terminator_function_erlang">.</span></span></span>
</pre>

Now, whenever you execute `3 4 +` you should get a friendly error.

## Simple Addition and Multiplication

Let's write the addition operator so we don't get an error at all when we do `3 4 +`:

<pre class="textmate-source sunburst"><span class="source source_erlang"><span class="meta meta_function meta_function_erlang"><span class="entity entity_name entity_name_function entity_name_function_definition entity_name_function_definition_erlang">eval</span><span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_begin punctuation_definition_parameters_begin_erlang">(</span><span class="meta meta_structure meta_structure_list meta_structure_list_erlang"><span class="punctuation punctuation_definition punctuation_definition_list punctuation_definition_list_begin punctuation_definition_list_begin_erlang">[</span><span class="string string_quoted string_quoted_double string_quoted_double_erlang"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_erlang">"</span>+<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_erlang">"</span></span><span class="punctuation punctuation_separator punctuation_separator_list punctuation_separator_list_erlang">|</span><span class="variable variable_other variable_other_erlang">Rest</span><span class="punctuation punctuation_definition punctuation_definition_list punctuation_definition_list_end punctuation_definition_list_end_erlang">]</span></span><span class="punctuation punctuation_separator punctuation_separator_parameters punctuation_separator_parameters_erlang">,</span> <span class="variable variable_other variable_other_erlang">Stack</span><span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_end punctuation_definition_parameters_end_erlang">)</span> <span class="punctuation punctuation_separator punctuation_separator_clause-head-body punctuation_separator_clause-head-body_erlang">-&gt;</span>
  <span class="meta meta_structure meta_structure_list meta_structure_list_erlang"><span class="punctuation punctuation_definition punctuation_definition_list punctuation_definition_list_begin punctuation_definition_list_begin_erlang">[</span><span class="variable variable_other variable_other_erlang">Alpha</span><span class="punctuation punctuation_separator punctuation_separator_list punctuation_separator_list_erlang">|</span><span class="meta meta_structure meta_structure_list meta_structure_list_erlang"><span class="punctuation punctuation_definition punctuation_definition_list punctuation_definition_list_begin punctuation_definition_list_begin_erlang">[</span><span class="variable variable_other variable_other_erlang">Bravo</span><span class="punctuation punctuation_separator punctuation_separator_list punctuation_separator_list_erlang">|</span><span class="variable variable_other variable_other_erlang">Remain</span><span class="punctuation punctuation_definition punctuation_definition_list punctuation_definition_list_end punctuation_definition_list_end_erlang">]</span></span><span class="punctuation punctuation_definition punctuation_definition_list punctuation_definition_list_end punctuation_definition_list_end_erlang">]</span></span> <span class="keyword keyword_operator keyword_operator_symbolic keyword_operator_symbolic_erlang">=</span> <span class="variable variable_other variable_other_erlang">Stack</span><span class="punctuation punctuation_separator punctuation_separator_expressions punctuation_separator_expressions_erlang">,</span>
  <span class="variable variable_other variable_other_erlang">Sum</span> <span class="keyword keyword_operator keyword_operator_symbolic keyword_operator_symbolic_erlang">=</span> <span class="variable variable_other variable_other_erlang">Alpha</span> <span class="keyword keyword_operator keyword_operator_symbolic keyword_operator_symbolic_erlang">+</span> <span class="variable variable_other variable_other_erlang">Bravo</span><span class="punctuation punctuation_separator punctuation_separator_expressions punctuation_separator_expressions_erlang">,</span>
  <span class="meta meta_function-call meta_function-call_erlang">eval<span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_begin punctuation_definition_parameters_begin_erlang">(</span><span class="variable variable_other variable_other_erlang">Rest</span><span class="punctuation punctuation_separator punctuation_separator_parameters punctuation_separator_parameters_erlang">,</span> <span class="meta meta_structure meta_structure_list meta_structure_list_erlang"><span class="punctuation punctuation_definition punctuation_definition_list punctuation_definition_list_begin punctuation_definition_list_begin_erlang">[</span><span class="variable variable_other variable_other_erlang">Sum</span><span class="punctuation punctuation_separator punctuation_separator_list punctuation_separator_list_erlang">|</span><span class="variable variable_other variable_other_erlang">Remain</span><span class="punctuation punctuation_definition punctuation_definition_list punctuation_definition_list_end punctuation_definition_list_end_erlang">]</span></span><span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_end punctuation_definition_parameters_end_erlang">)</span></span><span class="punctuation punctuation_separator punctuation_separator_clauses punctuation_separator_clauses_erlang">;</span></span></span>
</pre>

This body of `eval/2` (which should go above the "Invalid opcode" body of the same function in your source file) only gets selected when it's presented with an array beginning with the string "+" as its first argument.  When it is selected, it:

1. Pulls the first two entries from `Stack` into the variables `Alpha` and `Bravo`, using the nested array notation from above.
2. Adds `Alpha` and `Bravo` together and calls the result `Sum`.
3. Recurs `eval/2` with the `Rest` of the input line, and a new stack consisting of the `Sum` in front of the `Remain`ing stack.

Let's implement multiplication too:

<pre class="textmate-source sunburst"><span class="source source_erlang"><span class="meta meta_function meta_function_erlang"><span class="entity entity_name entity_name_function entity_name_function_definition entity_name_function_definition_erlang">eval</span><span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_begin punctuation_definition_parameters_begin_erlang">(</span><span class="meta meta_structure meta_structure_list meta_structure_list_erlang"><span class="punctuation punctuation_definition punctuation_definition_list punctuation_definition_list_begin punctuation_definition_list_begin_erlang">[</span><span class="string string_quoted string_quoted_double string_quoted_double_erlang"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_erlang">"</span>*<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_erlang">"</span></span><span class="punctuation punctuation_separator punctuation_separator_list punctuation_separator_list_erlang">|</span><span class="variable variable_other variable_other_erlang">Rest</span><span class="punctuation punctuation_definition punctuation_definition_list punctuation_definition_list_end punctuation_definition_list_end_erlang">]</span></span><span class="punctuation punctuation_separator punctuation_separator_parameters punctuation_separator_parameters_erlang">,</span> <span class="variable variable_other variable_other_erlang">Stack</span><span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_end punctuation_definition_parameters_end_erlang">)</span> <span class="punctuation punctuation_separator punctuation_separator_clause-head-body punctuation_separator_clause-head-body_erlang">-&gt;</span>
  <span class="meta meta_structure meta_structure_list meta_structure_list_erlang"><span class="punctuation punctuation_definition punctuation_definition_list punctuation_definition_list_begin punctuation_definition_list_begin_erlang">[</span><span class="variable variable_other variable_other_erlang">Alpha</span><span class="punctuation punctuation_separator punctuation_separator_list punctuation_separator_list_erlang">|</span><span class="meta meta_structure meta_structure_list meta_structure_list_erlang"><span class="punctuation punctuation_definition punctuation_definition_list punctuation_definition_list_begin punctuation_definition_list_begin_erlang">[</span><span class="variable variable_other variable_other_erlang">Bravo</span><span class="punctuation punctuation_separator punctuation_separator_list punctuation_separator_list_erlang">|</span><span class="variable variable_other variable_other_erlang">Remain</span><span class="punctuation punctuation_definition punctuation_definition_list punctuation_definition_list_end punctuation_definition_list_end_erlang">]</span></span><span class="punctuation punctuation_definition punctuation_definition_list punctuation_definition_list_end punctuation_definition_list_end_erlang">]</span></span> <span class="keyword keyword_operator keyword_operator_symbolic keyword_operator_symbolic_erlang">=</span> <span class="variable variable_other variable_other_erlang">Stack</span><span class="punctuation punctuation_separator punctuation_separator_expressions punctuation_separator_expressions_erlang">,</span>
  <span class="variable variable_other variable_other_erlang">Sum</span> <span class="keyword keyword_operator keyword_operator_symbolic keyword_operator_symbolic_erlang">=</span> <span class="variable variable_other variable_other_erlang">Alpha</span> <span class="keyword keyword_operator keyword_operator_symbolic keyword_operator_symbolic_erlang">*</span> <span class="variable variable_other variable_other_erlang">Bravo</span><span class="punctuation punctuation_separator punctuation_separator_expressions punctuation_separator_expressions_erlang">,</span>
  <span class="meta meta_function-call meta_function-call_erlang">eval<span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_begin punctuation_definition_parameters_begin_erlang">(</span><span class="variable variable_other variable_other_erlang">Rest</span><span class="punctuation punctuation_separator punctuation_separator_parameters punctuation_separator_parameters_erlang">,</span> <span class="meta meta_structure meta_structure_list meta_structure_list_erlang"><span class="punctuation punctuation_definition punctuation_definition_list punctuation_definition_list_begin punctuation_definition_list_begin_erlang">[</span><span class="variable variable_other variable_other_erlang">Sum</span><span class="punctuation punctuation_separator punctuation_separator_list punctuation_separator_list_erlang">|</span><span class="variable variable_other variable_other_erlang">Remain</span><span class="punctuation punctuation_definition punctuation_definition_list punctuation_definition_list_end punctuation_definition_list_end_erlang">]</span></span><span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_end punctuation_definition_parameters_end_erlang">)</span></span><span class="punctuation punctuation_separator punctuation_separator_clauses punctuation_separator_clauses_erlang">;</span></span></span>
</pre>

Not too surprisingly, there's a lot of repeated code here, since they're both operations that pop off the stack twice, perform  calculation, and push a result on.  There'll be even more repetition as we implement division, subtraction, and various bit-twiddling operations.  Let's put a stop to that.

## Popping twice

The first thing we do in any of these binary operations is always going to be popping two entries off the stack.  Let's write `pop_two/1`, which takes the `Stack`, and returns its first two entries and the remaining stack in a tuple (that we'll immediately unpack).

<pre class="textmate-source sunburst"><span class="source source_erlang"><span class="meta meta_function meta_function_erlang"><span class="entity entity_name entity_name_function entity_name_function_erlang">pop_two</span><span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_begin punctuation_definition_parameters_begin_erlang">(</span><span class="variable variable_other variable_other_erlang">Stack</span><span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_end punctuation_definition_parameters_end_erlang">)</span> <span class="punctuation punctuation_separator punctuation_separator_clause-head-body punctuation_separator_clause-head-body_erlang">-&gt;</span>
  <span class="meta meta_structure meta_structure_list meta_structure_list_erlang"><span class="punctuation punctuation_definition punctuation_definition_list punctuation_definition_list_begin punctuation_definition_list_begin_erlang">[</span><span class="variable variable_other variable_other_erlang">Alpha</span><span class="punctuation punctuation_separator punctuation_separator_list punctuation_separator_list_erlang">|</span><span class="meta meta_structure meta_structure_list meta_structure_list_erlang"><span class="punctuation punctuation_definition punctuation_definition_list punctuation_definition_list_begin punctuation_definition_list_begin_erlang">[</span><span class="variable variable_other variable_other_erlang">Bravo</span><span class="punctuation punctuation_separator punctuation_separator_list punctuation_separator_list_erlang">|</span><span class="variable variable_other variable_other_erlang">Remain</span><span class="punctuation punctuation_definition punctuation_definition_list punctuation_definition_list_end punctuation_definition_list_end_erlang">]</span></span><span class="punctuation punctuation_definition punctuation_definition_list punctuation_definition_list_end punctuation_definition_list_end_erlang">]</span></span> <span class="keyword keyword_operator keyword_operator_symbolic keyword_operator_symbolic_erlang">=</span> <span class="variable variable_other variable_other_erlang">Stack</span><span class="punctuation punctuation_separator punctuation_separator_expressions punctuation_separator_expressions_erlang">,</span>
  <span class="meta meta_structure meta_structure_tuple meta_structure_tuple_erlang"><span class="punctuation punctuation_definition punctuation_definition_tuple punctuation_definition_tuple_begin punctuation_definition_tuple_begin_erlang">{</span><span class="variable variable_other variable_other_erlang">Alpha</span><span class="punctuation punctuation_separator punctuation_separator_tuple punctuation_separator_tuple_erlang">,</span> <span class="variable variable_other variable_other_erlang">Bravo</span><span class="punctuation punctuation_separator punctuation_separator_tuple punctuation_separator_tuple_erlang">,</span> <span class="variable variable_other variable_other_erlang">Remain</span><span class="punctuation punctuation_definition punctuation_definition_tuple punctuation_definition_tuple_end punctuation_definition_tuple_end_erlang">}</span></span><span class="punctuation punctuation_terminator punctuation_terminator_function punctuation_terminator_function_erlang">.</span></span></span>
</pre>

And rewrite addition and multiplication to use it:
<pre class="textmate-source sunburst"><span class="source source_erlang"><span class="meta meta_function meta_function_erlang"><span class="entity entity_name entity_name_function entity_name_function_definition entity_name_function_definition_erlang">eval</span><span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_begin punctuation_definition_parameters_begin_erlang">(</span><span class="meta meta_structure meta_structure_list meta_structure_list_erlang"><span class="punctuation punctuation_definition punctuation_definition_list punctuation_definition_list_begin punctuation_definition_list_begin_erlang">[</span><span class="string string_quoted string_quoted_double string_quoted_double_erlang"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_erlang">"</span>+<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_erlang">"</span></span><span class="punctuation punctuation_separator punctuation_separator_list punctuation_separator_list_erlang">|</span><span class="variable variable_other variable_other_erlang">Rest</span><span class="punctuation punctuation_definition punctuation_definition_list punctuation_definition_list_end punctuation_definition_list_end_erlang">]</span></span><span class="punctuation punctuation_separator punctuation_separator_parameters punctuation_separator_parameters_erlang">,</span> <span class="variable variable_other variable_other_erlang">Stack</span><span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_end punctuation_definition_parameters_end_erlang">)</span> <span class="punctuation punctuation_separator punctuation_separator_clause-head-body punctuation_separator_clause-head-body_erlang">-&gt;</span>
  <span class="meta meta_structure meta_structure_tuple meta_structure_tuple_erlang"><span class="punctuation punctuation_definition punctuation_definition_tuple punctuation_definition_tuple_begin punctuation_definition_tuple_begin_erlang">{</span><span class="variable variable_other variable_other_erlang">Alpha</span><span class="punctuation punctuation_separator punctuation_separator_tuple punctuation_separator_tuple_erlang">,</span> <span class="variable variable_other variable_other_erlang">Bravo</span><span class="punctuation punctuation_separator punctuation_separator_tuple punctuation_separator_tuple_erlang">,</span> <span class="variable variable_other variable_other_erlang">Remain</span><span class="punctuation punctuation_definition punctuation_definition_tuple punctuation_definition_tuple_end punctuation_definition_tuple_end_erlang">}</span></span> <span class="keyword keyword_operator keyword_operator_symbolic keyword_operator_symbolic_erlang">=</span> <span class="meta meta_function-call meta_function-call_erlang">pop_two<span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_begin punctuation_definition_parameters_begin_erlang">(</span><span class="variable variable_other variable_other_erlang">Stack</span><span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_end punctuation_definition_parameters_end_erlang">)</span></span><span class="punctuation punctuation_separator punctuation_separator_expressions punctuation_separator_expressions_erlang">,</span>
  <span class="variable variable_other variable_other_erlang">Sum</span> <span class="keyword keyword_operator keyword_operator_symbolic keyword_operator_symbolic_erlang">=</span> <span class="variable variable_other variable_other_erlang">Alpha</span> <span class="keyword keyword_operator keyword_operator_symbolic keyword_operator_symbolic_erlang">+</span> <span class="variable variable_other variable_other_erlang">Bravo</span><span class="punctuation punctuation_separator punctuation_separator_expressions punctuation_separator_expressions_erlang">,</span>
  <span class="meta meta_function-call meta_function-call_erlang">eval<span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_begin punctuation_definition_parameters_begin_erlang">(</span><span class="variable variable_other variable_other_erlang">Rest</span><span class="punctuation punctuation_separator punctuation_separator_parameters punctuation_separator_parameters_erlang">,</span> <span class="meta meta_structure meta_structure_list meta_structure_list_erlang"><span class="punctuation punctuation_definition punctuation_definition_list punctuation_definition_list_begin punctuation_definition_list_begin_erlang">[</span><span class="variable variable_other variable_other_erlang">Sum</span><span class="punctuation punctuation_separator punctuation_separator_list punctuation_separator_list_erlang">|</span><span class="variable variable_other variable_other_erlang">Remain</span><span class="punctuation punctuation_definition punctuation_definition_list punctuation_definition_list_end punctuation_definition_list_end_erlang">]</span></span><span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_end punctuation_definition_parameters_end_erlang">)</span></span><span class="punctuation punctuation_separator punctuation_separator_clauses punctuation_separator_clauses_erlang">;</span>

<span class="entity entity_name entity_name_function entity_name_function_erlang">eval</span><span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_begin punctuation_definition_parameters_begin_erlang">(</span><span class="meta meta_structure meta_structure_list meta_structure_list_erlang"><span class="punctuation punctuation_definition punctuation_definition_list punctuation_definition_list_begin punctuation_definition_list_begin_erlang">[</span><span class="string string_quoted string_quoted_double string_quoted_double_erlang"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_erlang">"</span>*<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_erlang">"</span></span><span class="punctuation punctuation_separator punctuation_separator_list punctuation_separator_list_erlang">|</span><span class="variable variable_other variable_other_erlang">Rest</span><span class="punctuation punctuation_definition punctuation_definition_list punctuation_definition_list_end punctuation_definition_list_end_erlang">]</span></span><span class="punctuation punctuation_separator punctuation_separator_parameters punctuation_separator_parameters_erlang">,</span> <span class="variable variable_other variable_other_erlang">Stack</span><span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_end punctuation_definition_parameters_end_erlang">)</span> <span class="punctuation punctuation_separator punctuation_separator_clause-head-body punctuation_separator_clause-head-body_erlang">-&gt;</span>  
  <span class="meta meta_structure meta_structure_list meta_structure_list_erlang"><span class="punctuation punctuation_definition punctuation_definition_list punctuation_definition_list_begin punctuation_definition_list_begin_erlang">[</span><span class="variable variable_other variable_other_erlang">Alpha</span><span class="punctuation punctuation_separator punctuation_separator_list punctuation_separator_list_erlang">|</span><span class="meta meta_structure meta_structure_list meta_structure_list_erlang"><span class="punctuation punctuation_definition punctuation_definition_list punctuation_definition_list_begin punctuation_definition_list_begin_erlang">[</span><span class="variable variable_other variable_other_erlang">Bravo</span><span class="punctuation punctuation_separator punctuation_separator_list punctuation_separator_list_erlang">|</span><span class="variable variable_other variable_other_erlang">Remain</span><span class="punctuation punctuation_definition punctuation_definition_list punctuation_definition_list_end punctuation_definition_list_end_erlang">]</span></span><span class="punctuation punctuation_definition punctuation_definition_list punctuation_definition_list_end punctuation_definition_list_end_erlang">]</span></span> <span class="keyword keyword_operator keyword_operator_symbolic keyword_operator_symbolic_erlang">=</span> <span class="variable variable_other variable_other_erlang">Stack</span><span class="punctuation punctuation_separator punctuation_separator_expressions punctuation_separator_expressions_erlang">,</span>
  <span class="variable variable_other variable_other_erlang">Sum</span> <span class="keyword keyword_operator keyword_operator_symbolic keyword_operator_symbolic_erlang">=</span> <span class="variable variable_other variable_other_erlang">Alpha</span> <span class="keyword keyword_operator keyword_operator_symbolic keyword_operator_symbolic_erlang">*</span> <span class="variable variable_other variable_other_erlang">Bravo</span><span class="punctuation punctuation_separator punctuation_separator_expressions punctuation_separator_expressions_erlang">,</span>
  <span class="meta meta_function-call meta_function-call_erlang">eval<span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_begin punctuation_definition_parameters_begin_erlang">(</span><span class="variable variable_other variable_other_erlang">Rest</span><span class="punctuation punctuation_separator punctuation_separator_parameters punctuation_separator_parameters_erlang">,</span> <span class="meta meta_structure meta_structure_list meta_structure_list_erlang"><span class="punctuation punctuation_definition punctuation_definition_list punctuation_definition_list_begin punctuation_definition_list_begin_erlang">[</span><span class="variable variable_other variable_other_erlang">Sum</span><span class="punctuation punctuation_separator punctuation_separator_list punctuation_separator_list_erlang">|</span><span class="variable variable_other variable_other_erlang">Remain</span><span class="punctuation punctuation_definition punctuation_definition_list punctuation_definition_list_end punctuation_definition_list_end_erlang">]</span></span><span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_end punctuation_definition_parameters_end_erlang">)</span></span><span class="punctuation punctuation_separator punctuation_separator_clauses punctuation_separator_clauses_erlang">;</span></span></span>
</pre>

Actually, let's not.  Doing it this way does clear up some possibly confusing syntax; but what we *really* want is a way to get rid of *even more* repeated code, such as the first and last lines of the function.

<pre class="textmate-source sunburst"><span class="source source_erlang"><span class="meta meta_function meta_function_erlang"><span class="entity entity_name entity_name_function entity_name_function_definition entity_name_function_definition_erlang">eval</span><span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_begin punctuation_definition_parameters_begin_erlang">(</span><span class="meta meta_structure meta_structure_list meta_structure_list_erlang"><span class="punctuation punctuation_definition punctuation_definition_list punctuation_definition_list_begin punctuation_definition_list_begin_erlang">[</span><span class="string string_quoted string_quoted_double string_quoted_double_erlang"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_erlang">"</span>+<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_erlang">"</span></span><span class="punctuation punctuation_separator punctuation_separator_list punctuation_separator_list_erlang">|</span><span class="variable variable_other variable_other_erlang">Rest</span><span class="punctuation punctuation_definition punctuation_definition_list punctuation_definition_list_end punctuation_definition_list_end_erlang">]</span></span><span class="punctuation punctuation_separator punctuation_separator_parameters punctuation_separator_parameters_erlang">,</span> <span class="variable variable_other variable_other_erlang">Stack</span><span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_end punctuation_definition_parameters_end_erlang">)</span> <span class="punctuation punctuation_separator punctuation_separator_clause-head-body punctuation_separator_clause-head-body_erlang">-&gt;</span>
  <span class="variable variable_other variable_other_erlang">Addition</span> <span class="keyword keyword_operator keyword_operator_symbolic keyword_operator_symbolic_erlang">=</span> <span class="meta meta_expression meta_expression_fun meta_expression_fun_erlang"><span class="keyword keyword_control keyword_control_fun keyword_control_fun_erlang">fun</span> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_begin punctuation_definition_parameters_begin_erlang">(</span><span class="variable variable_other variable_other_erlang">A</span><span class="punctuation punctuation_separator punctuation_separator_parameters punctuation_separator_parameters_erlang">,</span><span class="variable variable_other variable_other_erlang">B</span><span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_end punctuation_definition_parameters_end_erlang">)</span> <span class="punctuation punctuation_separator punctuation_separator_clause-head-body punctuation_separator_clause-head-body_erlang">-&gt;</span>
    <span class="variable variable_other variable_other_erlang">A</span><span class="keyword keyword_operator keyword_operator_symbolic keyword_operator_symbolic_erlang">+</span><span class="variable variable_other variable_other_erlang">B</span>
  <span class="keyword keyword_control keyword_control_end keyword_control_end_erlang">end</span></span><span class="punctuation punctuation_separator punctuation_separator_expressions punctuation_separator_expressions_erlang">,</span>
  <span class="meta meta_function-call meta_function-call_erlang">binary_op<span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_begin punctuation_definition_parameters_begin_erlang">(</span><span class="variable variable_other variable_other_erlang">Addition</span><span class="punctuation punctuation_separator punctuation_separator_parameters punctuation_separator_parameters_erlang">,</span> <span class="variable variable_other variable_other_erlang">Stack</span><span class="punctuation punctuation_separator punctuation_separator_parameters punctuation_separator_parameters_erlang">,</span> <span class="variable variable_other variable_other_erlang">Rest</span><span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_end punctuation_definition_parameters_end_erlang">)</span></span><span class="punctuation punctuation_separator punctuation_separator_clauses punctuation_separator_clauses_erlang">;</span>

<span class="entity entity_name entity_name_function entity_name_function_erlang">eval</span><span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_begin punctuation_definition_parameters_begin_erlang">(</span><span class="meta meta_structure meta_structure_list meta_structure_list_erlang"><span class="punctuation punctuation_definition punctuation_definition_list punctuation_definition_list_begin punctuation_definition_list_begin_erlang">[</span><span class="string string_quoted string_quoted_double string_quoted_double_erlang"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_erlang">"</span>*<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_erlang">"</span></span><span class="punctuation punctuation_separator punctuation_separator_list punctuation_separator_list_erlang">|</span><span class="variable variable_other variable_other_erlang">Rest</span><span class="punctuation punctuation_definition punctuation_definition_list punctuation_definition_list_end punctuation_definition_list_end_erlang">]</span></span><span class="punctuation punctuation_separator punctuation_separator_parameters punctuation_separator_parameters_erlang">,</span> <span class="variable variable_other variable_other_erlang">Stack</span><span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_end punctuation_definition_parameters_end_erlang">)</span> <span class="punctuation punctuation_separator punctuation_separator_clause-head-body punctuation_separator_clause-head-body_erlang">-&gt;</span>
  <span class="meta meta_function-call meta_function-call_erlang">binary_op<span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_begin punctuation_definition_parameters_begin_erlang">(</span><span class="meta meta_expression meta_expression_fun meta_expression_fun_erlang"><span class="keyword keyword_control keyword_control_fun keyword_control_fun_erlang">fun</span> <span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_begin punctuation_definition_parameters_begin_erlang">(</span><span class="variable variable_other variable_other_erlang">A</span><span class="punctuation punctuation_separator punctuation_separator_parameters punctuation_separator_parameters_erlang">,</span><span class="variable variable_other variable_other_erlang">B</span><span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_end punctuation_definition_parameters_end_erlang">)</span> <span class="punctuation punctuation_separator punctuation_separator_clause-head-body punctuation_separator_clause-head-body_erlang">-&gt;</span> <span class="variable variable_other variable_other_erlang">A</span><span class="keyword keyword_operator keyword_operator_symbolic keyword_operator_symbolic_erlang">*</span><span class="variable variable_other variable_other_erlang">B</span> <span class="keyword keyword_control keyword_control_end keyword_control_end_erlang">end</span></span><span class="punctuation punctuation_separator punctuation_separator_parameters punctuation_separator_parameters_erlang">,</span> <span class="variable variable_other variable_other_erlang">Stack</span><span class="punctuation punctuation_separator punctuation_separator_parameters punctuation_separator_parameters_erlang">,</span> <span class="variable variable_other variable_other_erlang">Rest</span><span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_end punctuation_definition_parameters_end_erlang">)</span></span><span class="punctuation punctuation_separator punctuation_separator_clauses punctuation_separator_clauses_erlang">;</span></span></span>
</pre>

Now *this* is functional programming!  We can just say that `Addition` is a function with an arity of 2 and that returns the sum of its arguments, and call a hypothetical `binary_op/3`  that handles all the popping, pushing, and recurring.  We don't even have to assign the `fun` for the operation to a variable, just use it in place (see the multiplication operation).

<pre class="textmate-source sunburst"><span class="source source_erlang"><span class="meta meta_function meta_function_erlang"><span class="entity entity_name entity_name_function entity_name_function_definition entity_name_function_definition_erlang">binary_op</span><span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_begin punctuation_definition_parameters_begin_erlang">(</span><span class="variable variable_other variable_other_erlang">Fun</span><span class="punctuation punctuation_separator punctuation_separator_parameters punctuation_separator_parameters_erlang">,</span> <span class="variable variable_other variable_other_erlang">Stack</span><span class="punctuation punctuation_separator punctuation_separator_parameters punctuation_separator_parameters_erlang">,</span> <span class="variable variable_other variable_other_erlang">Rest</span><span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_end punctuation_definition_parameters_end_erlang">)</span> <span class="punctuation punctuation_separator punctuation_separator_clause-head-body punctuation_separator_clause-head-body_erlang">-&gt;</span>
  <span class="meta meta_structure meta_structure_list meta_structure_list_erlang"><span class="punctuation punctuation_definition punctuation_definition_list punctuation_definition_list_begin punctuation_definition_list_begin_erlang">[</span><span class="variable variable_other variable_other_erlang">Alpha</span><span class="punctuation punctuation_separator punctuation_separator_list punctuation_separator_list_erlang">|</span><span class="meta meta_structure meta_structure_list meta_structure_list_erlang"><span class="punctuation punctuation_definition punctuation_definition_list punctuation_definition_list_begin punctuation_definition_list_begin_erlang">[</span><span class="variable variable_other variable_other_erlang">Bravo</span><span class="punctuation punctuation_separator punctuation_separator_list punctuation_separator_list_erlang">|</span><span class="variable variable_other variable_other_erlang">Remain</span><span class="punctuation punctuation_definition punctuation_definition_list punctuation_definition_list_end punctuation_definition_list_end_erlang">]</span></span><span class="punctuation punctuation_definition punctuation_definition_list punctuation_definition_list_end punctuation_definition_list_end_erlang">]</span></span> <span class="keyword keyword_operator keyword_operator_symbolic keyword_operator_symbolic_erlang">=</span> <span class="variable variable_other variable_other_erlang">Stack</span><span class="punctuation punctuation_separator punctuation_separator_expressions punctuation_separator_expressions_erlang">,</span>
  <span class="meta meta_expression meta_expression_case meta_expression_case_erlang"><span class="keyword keyword_control keyword_control_case keyword_control_case_erlang">case</span> <span class="variable variable_other variable_other_erlang">Fun</span><span class="meta meta_expression meta_expression_parenthesized"><span class="punctuation punctuation_section punctuation_section_expression punctuation_section_expression_begin punctuation_section_expression_begin_erlang">(</span><span class="variable variable_other variable_other_erlang">Alpha</span>, <span class="variable variable_other variable_other_erlang">Bravo</span><span class="punctuation punctuation_section punctuation_section_expression punctuation_section_expression_end punctuation_section_expression_end_erlang">)</span></span> <span class="keyword keyword_control keyword_control_erlang">of</span>
    <span class="meta meta_structure meta_structure_tuple meta_structure_tuple_erlang"><span class="punctuation punctuation_definition punctuation_definition_tuple punctuation_definition_tuple_begin punctuation_definition_tuple_begin_erlang">{</span><span class="constant constant_other constant_other_symbol constant_other_symbol_unquoted constant_other_symbol_unquoted_erlang">op_fail</span><span class="punctuation punctuation_separator punctuation_separator_tuple punctuation_separator_tuple_erlang">,</span> <span class="variable variable_other variable_other_erlang">Desc</span><span class="punctuation punctuation_definition punctuation_definition_tuple punctuation_definition_tuple_end punctuation_definition_tuple_end_erlang">}</span></span> <span class="punctuation punctuation_separator punctuation_separator_clause-head-body punctuation_separator_clause-head-body_erlang">-&gt;</span>
      <span class="meta meta_function-call meta_function-call_erlang">describe_error<span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_begin punctuation_definition_parameters_begin_erlang">(</span><span class="variable variable_other variable_other_erlang">Desc</span><span class="punctuation punctuation_separator punctuation_separator_parameters punctuation_separator_parameters_erlang">,</span> <span class="variable variable_other variable_other_erlang">Rest</span><span class="punctuation punctuation_separator punctuation_separator_parameters punctuation_separator_parameters_erlang">,</span> <span class="variable variable_other variable_other_erlang">Stack</span><span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_end punctuation_definition_parameters_end_erlang">)</span></span><span class="punctuation punctuation_separator punctuation_separator_clauses punctuation_separator_clauses_erlang">;</span>
    <span class="variable variable_other variable_other_erlang">Result</span> <span class="punctuation punctuation_separator punctuation_separator_clause-head-body punctuation_separator_clause-head-body_erlang">-&gt;</span>
      <span class="meta meta_function-call meta_function-call_erlang">eval<span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_begin punctuation_definition_parameters_begin_erlang">(</span><span class="variable variable_other variable_other_erlang">Rest</span><span class="punctuation punctuation_separator punctuation_separator_parameters punctuation_separator_parameters_erlang">,</span> <span class="meta meta_structure meta_structure_list meta_structure_list_erlang"><span class="punctuation punctuation_definition punctuation_definition_list punctuation_definition_list_begin punctuation_definition_list_begin_erlang">[</span><span class="variable variable_other variable_other_erlang">Result</span><span class="punctuation punctuation_separator punctuation_separator_list punctuation_separator_list_erlang">|</span><span class="variable variable_other variable_other_erlang">Remain</span><span class="punctuation punctuation_definition punctuation_definition_list punctuation_definition_list_end punctuation_definition_list_end_erlang">]</span></span><span class="punctuation punctuation_definition punctuation_definition_parameters punctuation_definition_parameters_end punctuation_definition_parameters_end_erlang">)</span></span>
  <span class="keyword keyword_control keyword_control_erlang">end</span><span class="punctuation punctuation_terminator punctuation_terminator_function punctuation_terminator_function_erlang">.</span></span></span>
</pre>

This is a bit more complicated than *strictly* necessary, but this lets the `fun` we're called with throw an error message if necessary (for example, if we have operations that can only operate on integers) by returning a 2-tuple with the `op_fail` symbol in the first position, and a `Desc`ription of the error in the second.

# Looking Ahead

I haven't explored any operations beyond addition and multiplication in this post because their implementation should be self-evident.

I also haven't gone into any serious programming language features like storing and retrieving values, subprocedures, conditionals, and so on because this is just a calculator project (but rest assured those are coming).

If you want to see tostada in its native habitat, visit #bots on irc.buttes.org and chat it up:
<pre class="textmate-source sunburst"><span class="source source_erlang"><span class="keyword keyword_operator keyword_operator_symbolic keyword_operator_symbolic_erlang">&lt;bonzo&gt;</span> <span class="constant constant_other constant_other_symbol constant_other_symbol_unquoted constant_other_symbol_unquoted_erlang">obs</span> <span class="constant constant_numeric constant_numeric_integer constant_numeric_integer_decimal constant_numeric_integer_decimal_erlang">123 456 +</span>
<span class="keyword keyword_operator keyword_operator_symbolic keyword_operator_symbolic_erlang">&lt;tostada&gt;</span> <span class="meta meta_structure meta_structure_list meta_structure_list_erlang"><span class="constant constant_numeric constant_numeric_integer constant_numeric_integer_decimal constant_numeric_integer_decimal_erlang">[579]</span></span></span>
</pre>

